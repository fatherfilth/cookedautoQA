---
phase: 08-test-enablement
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/auth/auth.setup.ts
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "Auth setup project registers account without strict mode violation"
    - "Terms checkbox interaction targets exactly one element"
    - "storageState saved to .auth/user.json after successful registration"
  artifacts:
    - path: "tests/auth/auth.setup.ts"
      provides: "Registration flow with fixed checkbox selector"
      contains: "#tos-checkbox"
  key_links:
    - from: "tests/auth/auth.setup.ts"
      to: ".auth/user.json"
      via: "storageState save after registration"
      pattern: "storageState.*\\.auth/user\\.json"
---

<objective>
Fix auth.setup.ts checkbox selector that causes Playwright strict mode violation, unblocking all 8 auth-gated tests.

Purpose: The Phase 7 setup project's terms checkbox selector resolves to 2 elements (a hidden `input[type=checkbox][aria-hidden=true]` and a visible `button[role=checkbox][id=tos-checkbox]`). Playwright's strict mode rejects actions on locators matching multiple elements. This prevents registration, which prevents storageState creation, which blocks all 8 auth-gated tests from Phase 8.

Output: Fixed `tests/auth/auth.setup.ts` with a selector that targets exactly the visible checkbox element.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-test-enablement/08-VERIFICATION.md
@.planning/phases/07-auth-foundation/07-01-SUMMARY.md
@tests/auth/auth.setup.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix terms checkbox selector to target single visible element</name>
  <files>tests/auth/auth.setup.ts</files>
  <action>
Replace the terms checkbox selector (lines 40-42) that causes strict mode violation.

**Current code (broken):**
```typescript
const termsCheckbox = authDialog.getByRole('checkbox', { name: /terms|agree/i }).or(
    authDialog.locator('input[type="checkbox"]').first()
);
```

**Problem:** `getByRole('checkbox')` matches both:
1. Hidden: `input[type=checkbox][aria-hidden=true]` (native checkbox hidden by CSS)
2. Visible: `button[role=checkbox][id=tos-checkbox]` (custom checkbox component)

Playwright strict mode requires exactly 1 match for `.check()`.

**Fix:** Replace with a selector that targets only the visible custom checkbox element:

```typescript
const termsCheckbox = authDialog.locator('#tos-checkbox').or(
    authDialog.locator('button[role="checkbox"]').first()
);
```

**Why this works:**
- `#tos-checkbox` targets the specific visible button element by ID (most precise)
- `.or()` fallback uses `button[role="checkbox"]` which excludes `input[type="checkbox"]`
- Both branches resolve to exactly 1 element (no strict mode violation)

**Do NOT change:**
- The `if (await termsCheckbox.count() > 0)` guard (lines 43-45) — keep conditional check
- The `.check()` call — keep as-is
- Any other selectors in the file (email, password, username, submit button, auth indicator)
  </action>
  <verify>
1. Run `npx tsc --noEmit` — file compiles cleanly
2. Run `npx playwright test --list` — setup project still listed
3. Verify the selector no longer uses `getByRole('checkbox')` or bare `input[type="checkbox"]`:
   - `grep "getByRole.*checkbox" tests/auth/auth.setup.ts` should return 0 matches
   - `grep "tos-checkbox" tests/auth/auth.setup.ts` should return 1 match
  </verify>
  <done>
Terms checkbox selector in auth.setup.ts targets exactly one element (`#tos-checkbox` or `button[role="checkbox"]`), eliminating the strict mode violation that prevented registration and storageState creation.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (TypeScript compiles cleanly)
2. `npx playwright test --list` shows setup project with 1 test
3. No `getByRole('checkbox')` calls in auth.setup.ts
4. `#tos-checkbox` selector present in auth.setup.ts
5. All other selectors in auth.setup.ts unchanged (email, password, username, submit, auth indicator)
</verification>

<success_criteria>
- auth.setup.ts checkbox selector targets single element (no strict mode violation)
- File compiles with TypeScript
- Setup project appears in test listing
- No regressions to other selectors in the file
</success_criteria>

<output>
After completion, create `.planning/phases/08-test-enablement/08-03-SUMMARY.md`
</output>
