---
phase: 10-betting-activity-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/betting/betting-activity.spec.ts
autonomous: true
must_haves:
  truths:
    - "All Bets tab shows betting activity entries at the bottom of the page"
    - "High Rollers tab shows betting activity entries at the bottom of the page"
    - "Both betting activity tests pass reliably in CI"
  artifacts:
    - path: "tests/betting/betting-activity.spec.ts"
      provides: "Betting activity component tests for All Bets and High Rollers tabs"
      contains: "All Bets"
    - path: "tests/betting/betting-activity.spec.ts"
      provides: "High Rollers tab test"
      contains: "High Rollers"
  key_links:
    - from: "tests/betting/betting-activity.spec.ts"
      to: "cooked.com homepage"
      via: "page.goto('/') and scroll to bottom"
      pattern: "page\\.goto\\('/'\\)"
---

<objective>
Create Playwright tests that validate the betting activity component at the bottom of cooked.com pages. Two tests: one for the "All Bets" tab and one for the "High Rollers" tab, each asserting that betting entries are visible.

Purpose: Validates that the live betting activity feed (a key social proof component for the casino) renders correctly, covering requirements BET-01 and BET-02.
Output: `tests/betting/betting-activity.spec.ts` with 2 passing tests.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@tests/smoke/homepage.spec.ts
@tests/social/promotions.spec.ts
@tests/helpers/test-config.ts
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create betting activity spec with All Bets and High Rollers tests</name>
  <files>tests/betting/betting-activity.spec.ts</files>
  <action>
Create `tests/betting/` directory and `betting-activity.spec.ts` with two test cases.

**Live site pattern (from PROJECT.md):** "Betting activity table at bottom of pages with 'All Bets' and 'High Rollers' tabs"

**Test 1: All Bets tab shows betting entries (BET-01)**
- Navigate to homepage (`page.goto('/')`)
- Scroll to the bottom of the page to ensure the betting activity component is in viewport (`page.evaluate(() => window.scrollTo(0, document.body.scrollHeight))`)
- Locate the betting activity section — look for text "All Bets" using `page.getByRole('tab', { name: /all bets/i })` with `.or(page.getByText(/all bets/i))` fallback
- The "All Bets" tab should be visible/active by default
- Assert at least one betting entry row is visible in the table/list below the tabs. Use `page.locator('table tbody tr, [class*="bet"] [class*="row"], [class*="activity"] [class*="row"]').first()` with 15s timeout — betting data loads dynamically
- Assert the entry has text content (not empty placeholder)
- Tag: `@warning @betting`

**Test 2: High Rollers tab shows betting entries (BET-02)**
- Navigate to homepage (`page.goto('/')`)
- Scroll to bottom of page
- Locate the "High Rollers" tab using `page.getByRole('tab', { name: /high rollers/i })` with `.or(page.getByText(/high rollers/i))` fallback
- Click the High Rollers tab
- Wait for the tab content to update — `page.waitForTimeout(1000)` is acceptable here since we need to wait for tab switch animation/re-render, or better: wait for a row element in the refreshed list
- Assert at least one betting entry row is visible (same pattern as Test 1)
- Assert the entry has text content
- Tag: `@warning @betting`

**Selector strategy (follows project conventions):**
- Prefer `getByRole('tab', ...)` for tab buttons (accessible, resilient)
- Use `.or()` fallback to text-based selectors since we have not inspected the live DOM for this component
- For betting entry rows: use broad CSS selectors with `.first()` since we do not know the exact DOM structure — table rows (`tr`) or div-based rows
- Use 15s timeout for dynamic content loading (consistent with other tests like lobby.spec.ts)

**File structure (follows existing test conventions):**
```typescript
import { test, expect } from '@playwright/test';

// Helper to scroll to bottom where betting activity lives
async function scrollToBottom(page) { ... }
```

Do NOT create a page object — this is a simple component check, not a complex page interaction. Inline selectors per convention for simpler test files (see promotions.spec.ts, homepage.spec.ts patterns).
  </action>
  <verify>
1. `npx tsc --noEmit` passes (no type errors)
2. `npx playwright test --list` shows the 2 new betting tests (total should increase from 18 to 20)
3. File exists at `tests/betting/betting-activity.spec.ts`
4. Both tests tagged with `@warning @betting`
  </verify>
  <done>
- `tests/betting/betting-activity.spec.ts` exists with 2 test cases
- Test 1 validates "All Bets" tab shows at least one betting entry with text content
- Test 2 validates "High Rollers" tab shows at least one betting entry with text content after clicking the tab
- TypeScript compiles without errors
- Playwright lists 20 tests (18 existing + 2 new)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update test count references and verify integration</name>
  <files>tests/betting/betting-activity.spec.ts</files>
  <action>
Verify the new tests integrate properly with the existing test suite:

1. Run `npx playwright test --list` to confirm 20 tests are listed (18 existing + 2 new betting tests)
2. Confirm the new tests appear under the `chromium` project (they use storageState from setup, meaning they run as authenticated — betting activity may require auth)
3. If tests do NOT need authentication (betting activity is visible to anonymous users), the tests will still work fine with the authenticated session — no changes needed
4. Run `npx tsc --noEmit` to confirm no type errors across the full codebase

**Important:** Do NOT run the actual tests against the live site — just verify they are listed and compile. Actual execution happens in CI.

If the test file has any syntax issues found during verification, fix them in-place.
  </action>
  <verify>
1. `npx tsc --noEmit` exits with code 0
2. `npx playwright test --list` shows exactly 20 tests
3. Both new tests appear in the list output
  </verify>
  <done>
- 20 tests listed in Playwright (18 + 2 new)
- Zero TypeScript compilation errors
- New betting tests are recognized by Playwright runner
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npx playwright test --list` shows 20 tests total
3. `tests/betting/betting-activity.spec.ts` exists and contains tests for both "All Bets" and "High Rollers" tabs
4. Tests use `@warning @betting` tags consistent with non-critical monitoring tests
5. No existing tests are modified or broken
</verification>

<success_criteria>
- BET-01 satisfied: Test validates "All Bets" tab shows betting entries at bottom of page
- BET-02 satisfied: Test validates "High Rollers" tab shows betting entries at bottom of page
- Test count: 20 (18 existing + 2 new)
- TypeScript compiles cleanly
- Tests integrate with existing Playwright config (chromium project, storageState)
</success_criteria>

<output>
After completion, create `.planning/phases/10-betting-activity-tests/10-01-SUMMARY.md`
</output>
