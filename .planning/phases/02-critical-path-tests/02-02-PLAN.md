---
phase: 02-critical-path-tests
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/helpers/game-config.ts
  - tests/game/slot-launch.spec.ts
  - tests/game/table-launch.spec.ts
  - tests/game/live-dealer-launch.spec.ts
  - .env.example
autonomous: true

must_haves:
  truths:
    - "Slot game launches successfully — iframe loads and game content is detectable inside iframe"
    - "Table game launches successfully — iframe loads and game content is detectable inside iframe"
    - "Live dealer game launches successfully — iframe loads and game content is detectable inside iframe"
    - "Game launch tests use configurable game IDs via environment variables with sensible defaults"
  artifacts:
    - path: "tests/helpers/game-config.ts"
      provides: "Centralized game ID configuration from environment variables"
      contains: "GAME_SLOT_ID"
    - path: "tests/game/slot-launch.spec.ts"
      provides: "Slot game launch monitoring test"
      contains: "@critical @game"
    - path: "tests/game/table-launch.spec.ts"
      provides: "Table game launch monitoring test"
      contains: "@critical @game"
    - path: "tests/game/live-dealer-launch.spec.ts"
      provides: "Live dealer game launch monitoring test"
      contains: "@critical @game"
    - path: ".env.example"
      provides: "Environment variable template updated with game ID variables"
      contains: "GAME_SLOT_ID"
  key_links:
    - from: "tests/game/slot-launch.spec.ts"
      to: "tests/helpers/game-config.ts"
      via: "import gameConfig"
      pattern: "import.*gameConfig"
    - from: "tests/game/slot-launch.spec.ts"
      to: "tests/pages/GameDetailPage.ts"
      via: "import GameDetailPage"
      pattern: "import.*GameDetailPage"
    - from: "tests/helpers/game-config.ts"
      to: "process.env.GAME_SLOT_ID"
      via: "environment variable read"
      pattern: "process\\.env\\.GAME_"
---

<objective>
Create game launch monitoring tests (GAME-01 through GAME-04) that validate slot, table, and live dealer games load their iframes and initialize, using configurable game IDs from environment variables.

Purpose: Game launches are the primary revenue flow. If games don't load, the casino is down. These tests detect iframe loading failures, provider issues, and game initialization problems.
Output: 1 game config helper, 3 game launch test spec files in tests/game/, updated .env.example with game ID variables.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@tests/pages/GameDetailPage.ts
@tests/pages/BasePage.ts
@tests/helpers/test-config.ts
@tests/helpers/waits.ts
@.env.example
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create game config helper and update .env.example (GAME-04)</name>
  <files>tests/helpers/game-config.ts, .env.example</files>
  <action>
Create `tests/helpers/game-config.ts`:
- Export a `gameConfig` const object with three categories: `slot`, `table`, `live`
- Each category has `id` (string) and `name` (string) properties
- Read from environment variables with fallback defaults:
  ```
  slot: {
    id: process.env.GAME_SLOT_ID || 'starburst',
    name: process.env.GAME_SLOT_NAME || 'Starburst',
  }
  table: {
    id: process.env.GAME_TABLE_ID || 'blackjack',
    name: process.env.GAME_TABLE_NAME || 'Blackjack',
  }
  live: {
    id: process.env.GAME_LIVE_ID || 'live-roulette',
    name: process.env.GAME_LIVE_NAME || 'Live Roulette',
  }
  ```
- Use `as const` for type safety
- Add a JSDoc comment explaining that defaults are placeholders and should be overridden via environment variables after inspecting the live site

Update `.env.example`:
- Add a "Game IDs for monitoring" section below the existing entries
- Add variables: GAME_SLOT_ID, GAME_SLOT_NAME, GAME_TABLE_ID, GAME_TABLE_NAME, GAME_LIVE_ID, GAME_LIVE_NAME
- Include comments explaining these are representative game IDs per category
- Keep all existing .env.example content intact
  </action>
  <verify>
Run `npm run typecheck` — no TypeScript errors.
Verify .env.example contains GAME_SLOT_ID, GAME_TABLE_ID, GAME_LIVE_ID.
Verify tests/helpers/game-config.ts exports gameConfig with slot, table, live properties.
  </verify>
  <done>
game-config.ts exports gameConfig with slot/table/live categories, each reading from environment variables with fallback defaults.
.env.example updated with 6 new game-related environment variables.
TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create slot, table, and live dealer launch tests (GAME-01, GAME-02, GAME-03)</name>
  <files>tests/game/slot-launch.spec.ts, tests/game/table-launch.spec.ts, tests/game/live-dealer-launch.spec.ts</files>
  <action>
Create the `tests/game/` directory if it doesn't exist.

Create `tests/game/slot-launch.spec.ts` for GAME-01:
- Import `test, expect` from `@playwright/test`
- Import `GameDetailPage` from `../pages/GameDetailPage.js`
- Import `gameConfig` from `../helpers/game-config.js`
- Single test: `'slot game launches successfully @critical @game'`
- Create `new GameDetailPage(page)`
- Navigate to game: `await gameDetailPage.gotoGame(gameConfig.slot.id)`
- Assert game iframe is visible with extended timeout: `await expect(gameDetailPage.gameIframe).toBeVisible({ timeout: 15_000 })`
- Access iframe content: `const gameFrame = page.frameLocator('iframe[src*="game"]').or(page.frameLocator('iframe').first())`
- Wait for game content inside iframe — use a broad check since we don't know provider-specific selectors yet: `await gameFrame.locator('canvas, [data-game-state], .game-container, body').first().waitFor({ state: 'visible', timeout: 30_000 })`
- Verify iframe has a src attribute (not empty): `const iframeSrc = await gameDetailPage.gameIframe.getAttribute('src'); expect(iframeSrc).toBeTruthy();`
- Add a comment: `// TODO: After live site inspection, replace broad iframe content selector with provider-specific game-ready indicator`

Create `tests/game/table-launch.spec.ts` for GAME-02:
- Same structure as slot-launch.spec.ts but using `gameConfig.table.id` and `gameConfig.table.name`
- Test title: `'table game launches successfully @critical @game'`
- Same iframe detection and content assertion pattern

Create `tests/game/live-dealer-launch.spec.ts` for GAME-03:
- Same structure as slot-launch.spec.ts but using `gameConfig.live.id` and `gameConfig.live.name`
- Test title: `'live dealer game launches successfully @critical @game'`
- Same iframe detection and content assertion pattern
- Add comment noting live dealer may have additional latency for video stream initialization

All three files follow the same pattern. Key points:
- Use `frameLocator()` (NOT `page.frame()`) per research recommendation
- Extended timeout of 30s for game initialization inside iframe (games load slowly)
- Do NOT use networkidle — wait for specific elements inside iframe
- Use broad element selector for iframe content since provider patterns are unknown
- All tests tagged @critical @game
- ESM imports with .js extensions
  </action>
  <verify>
Run `npx playwright test tests/game/ --list` — all 3 tests listed.
Run `npm run typecheck` — no TypeScript errors.
Run `npx playwright test --grep @game --list` — all 3 game tests appear.
Run `npx playwright test --grep @critical --list` — game tests appear alongside any other @critical tests.
  </verify>
  <done>
3 game launch test files exist in tests/game/, one per category (slot, table, live dealer).
Each test imports gameConfig for configurable game IDs and GameDetailPage for navigation.
Each test asserts iframe is visible, iframe has content, and iframe src is non-empty.
All tests tagged @critical @game. No networkidle or waitForTimeout.
TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
- tests/helpers/game-config.ts exists with slot/table/live config from env vars
- tests/game/ directory exists with 3 spec files (slot-launch, table-launch, live-dealer-launch)
- .env.example updated with GAME_SLOT_ID, GAME_TABLE_ID, GAME_LIVE_ID and their NAME counterparts
- All 3 game tests import gameConfig and GameDetailPage
- All 3 game tests use frameLocator() for iframe content (NOT page.frame())
- All 3 game tests tagged @critical @game
- No networkidle or waitForTimeout in any game test
- TypeScript compiles: `npm run typecheck` passes
</verification>

<success_criteria>
- 3 game launch tests exist and are listed by Playwright, covering GAME-01 (slot), GAME-02 (table), GAME-03 (live dealer)
- Game config helper provides configurable game IDs via environment variables (GAME-04)
- .env.example documents all game ID variables
- All game tests tagged @critical @game
- iframe content validated using frameLocator() with broad selector
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-critical-path-tests/02-02-SUMMARY.md`
</output>
