---
phase: 01-foundation-test-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - playwright.config.ts
  - .env.example
  - .gitignore
  - tests/smoke/.gitkeep
  - tests/helpers/.gitkeep
  - tests/pages/.gitkeep
  - scripts/.gitkeep
  - docs/.gitkeep
  - tests/smoke/health-check.spec.ts
autonomous: true

must_haves:
  truths:
    - "npx playwright test executes tests against BASE_URL with 2 retries"
    - "Screenshots captured only on failure, videos and traces only on first retry"
    - "Headless mode is default, setting HEADLESS=false enables headed mode"
    - "All secrets loaded from environment variables via dotenv, never hardcoded"
    - "Tests can be filtered by critical or warning tags"
    - "Folder structure follows convention with tests/smoke, tests/helpers, tests/pages, scripts, docs"
  artifacts:
    - path: "package.json"
      provides: "Project manifest with Playwright and dotenv dependencies"
      contains: "@playwright/test"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
      contains: "compilerOptions"
    - path: "playwright.config.ts"
      provides: "Playwright test configuration with artifacts, retries, headless, and dotenv"
      contains: "defineConfig"
    - path: ".env.example"
      provides: "Template for required environment variables"
      contains: "BASE_URL"
    - path: ".gitignore"
      provides: "Git ignore rules for secrets, artifacts, and node_modules"
      contains: ".env"
    - path: "tests/smoke/health-check.spec.ts"
      provides: "Verification test proving config works end-to-end"
      contains: "critical"
  key_links:
    - from: "playwright.config.ts"
      to: ".env"
      via: "dotenv.config() loads environment variables"
      pattern: "dotenv"
    - from: "playwright.config.ts"
      to: "process.env"
      via: "BASE_URL and HEADLESS read from env"
      pattern: "process.env"
---

<objective>
Scaffold the cooked-synthetic-monitor project from scratch with Playwright, TypeScript, and all configuration needed for reliable test execution.

Purpose: Establish the project foundation so all subsequent plans can import from `@playwright/test`, use dotenv for secrets, and run tests with correct artifact capture and retry behavior.
Output: A working project that can run `npx playwright test` successfully with proper configuration.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-test-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize project with Playwright, TypeScript, and dependencies</name>
  <files>
    package.json
    tsconfig.json
    .gitignore
    .env.example
    tests/smoke/.gitkeep
    tests/helpers/.gitkeep
    tests/pages/.gitkeep
    scripts/.gitkeep
    docs/.gitkeep
  </files>
  <action>
    1. Create `package.json` manually (do NOT run `npm init playwright@latest` interactively — it prompts). Set:
       - name: "cooked-synthetic-monitor"
       - version: "1.0.0"
       - description: "Synthetic monitoring for cooked.com critical user flows"
       - type: "module" (ESM)
       - scripts:
         - "test": "playwright test"
         - "test:critical": "playwright test --grep @critical"
         - "test:warning": "playwright test --grep @warning"
         - "test:headed": "cross-env HEADLESS=false playwright test"
         - "test:debug": "cross-env HEADLESS=false playwright test --debug"
         - "typecheck": "tsc --noEmit"
       - devDependencies: leave empty (will install below)

    2. Run `npm install --save-dev @playwright/test typescript dotenv cross-env` to install all dependencies.

    3. Run `npx playwright install chromium` to install only Chromium browser (sufficient for monitoring — full browser matrix is unnecessary overhead for smoke tests).

    4. Create `tsconfig.json`:
       ```json
       {
         "compilerOptions": {
           "target": "ES2022",
           "module": "ESNext",
           "moduleResolution": "bundler",
           "esModuleInterop": true,
           "allowImportingTsExtensions": true,
           "noEmit": true,
           "strict": true,
           "skipLibCheck": true,
           "forceConsistentCasingInFileNames": true,
           "resolveJsonModule": true,
           "baseUrl": ".",
           "paths": {
             "@helpers/*": ["tests/helpers/*"],
             "@pages/*": ["tests/pages/*"]
           }
         },
         "include": ["tests/**/*.ts", "playwright.config.ts"],
         "exclude": ["node_modules"]
       }
       ```

    5. Create `.gitignore` with:
       ```
       node_modules/
       .env
       test-results/
       playwright-report/
       blob-report/
       playwright/.cache/
       ```

    6. Create `.env.example` with:
       ```
       # Required
       BASE_URL=https://cooked.com

       # Test credentials
       TEST_USER_EMAIL=
       TEST_USER_PASSWORD=

       # Alerting (Phase 5)
       SLACK_WEBHOOK_URL=

       # Display mode (set to "false" for headed mode)
       HEADLESS=true
       ```

    7. Create folder structure with .gitkeep files:
       - tests/smoke/.gitkeep
       - tests/helpers/.gitkeep
       - tests/pages/.gitkeep
       - scripts/.gitkeep
       - docs/.gitkeep
  </action>
  <verify>
    - `ls package.json tsconfig.json .gitignore .env.example` — all exist
    - `node -e "const p = require('./package.json'); console.log(p.type === 'module' && !!p.scripts.test)"` — prints `true`
    - `ls node_modules/@playwright/test` — Playwright installed
    - `ls tests/smoke tests/helpers tests/pages scripts docs` — folders exist
    - `npx tsc --noEmit` — no TypeScript errors (empty project, should pass)
  </verify>
  <done>
    Project scaffolded with package.json (ESM, scripts), tsconfig.json (strict, path aliases), .gitignore, .env.example, and all required folder directories. Dependencies installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Playwright configuration and health-check smoke test</name>
  <files>
    playwright.config.ts
    tests/smoke/health-check.spec.ts
  </files>
  <action>
    1. Create `playwright.config.ts`:
       ```typescript
       import { defineConfig, devices } from '@playwright/test';
       import dotenv from 'dotenv';

       dotenv.config();

       export default defineConfig({
         testDir: './tests',
         fullyParallel: true,
         forbidOnly: !!process.env.CI,
         retries: process.env.CI ? 2 : 1,
         workers: process.env.CI ? 4 : undefined,
         reporter: [
           ['html', { open: 'never' }],
           ['list'],
         ],

         use: {
           baseURL: process.env.BASE_URL || 'https://cooked.com',
           headless: process.env.HEADLESS !== 'false',

           // Artifacts on failure only (INFRA-04)
           screenshot: 'only-on-failure',
           video: 'on-first-retry',
           trace: 'on-first-retry',

           // Timeouts
           actionTimeout: 15_000,
           navigationTimeout: 30_000,
         },

         timeout: 60_000,

         projects: [
           {
             name: 'chromium',
             use: { ...devices['Desktop Chrome'] },
           },
         ],
       });
       ```

       Key decisions in this config:
       - `retries: 1` locally, `2` in CI (RELY-01: retry 2-3 times before failure)
       - `screenshot: 'only-on-failure'` (INFRA-04: no screenshots on success)
       - `video: 'on-first-retry'` and `trace: 'on-first-retry'` (INFRA-04: captured on retry = only on failure path)
       - `headless: process.env.HEADLESS !== 'false'` (INFRA-07: headless default, env var override)
       - `baseURL` from process.env.BASE_URL (INFRA-06: env var config)
       - Chromium-only project (monitoring doesn't need cross-browser — single browser is sufficient and faster)

    2. Create `tests/smoke/health-check.spec.ts` — a minimal test that validates the entire config chain works:
       ```typescript
       import { test, expect } from '@playwright/test';

       test('homepage loads successfully @critical @smoke', async ({ page }) => {
         await page.goto('/');

         // Verify the page loaded — use a broad assertion that works regardless of content
         await expect(page).toHaveTitle(/.+/);

         // Verify we're on the expected domain
         expect(page.url()).toContain(process.env.BASE_URL || 'cooked.com');
       });
       ```

       This test proves:
       - dotenv loads BASE_URL from .env
       - Playwright config applies (baseURL, headless, timeouts)
       - Test tagging works (@critical, @smoke)
       - Artifacts would be captured on failure
       - retries would fire on flaky failure

    3. Create a `.env` file (local only, gitignored) with `BASE_URL=https://cooked.com` so the health check can run locally.
  </action>
  <verify>
    - `npx playwright test tests/smoke/health-check.spec.ts --reporter=list` — test runs (may pass or fail depending on network, but should not error on config)
    - `npx playwright test --grep @critical --list` — lists the health-check test (tag filtering works)
    - `grep "only-on-failure" playwright.config.ts` — screenshot config present
    - `grep "on-first-retry" playwright.config.ts` — video and trace config present
    - `grep "dotenv" playwright.config.ts` — dotenv loaded
  </verify>
  <done>
    Playwright config created with: dotenv loading, BASE_URL from env, headless by default with env override, artifacts on failure only, 2 retries in CI, Chromium-only project. Health-check smoke test proves the config chain works end-to-end with @critical/@smoke tags.
  </done>
</task>

</tasks>

<verification>
Run these checks to verify Plan 01 is complete:

1. `npm run typecheck` — no TypeScript errors
2. `npx playwright test --list` — health-check test listed
3. `npx playwright test --grep @critical --list` — filtered by tag
4. Folder structure: `ls tests/smoke tests/helpers tests/pages scripts docs` — all exist
5. Config chain: `node -e "require('dotenv').config(); console.log(process.env.BASE_URL)"` — prints URL
6. `.env` not tracked: `git status .env` — not in git
</verification>

<success_criteria>
- Project runs `npx playwright test` without configuration errors
- TypeScript compilation passes (`npx tsc --noEmit`)
- Test tagged @critical can be filtered with `--grep @critical`
- Screenshot, video, trace settings match requirements (only-on-failure / on-first-retry)
- Secrets loaded from .env via dotenv, .env.example committed, .env gitignored
- All required folders exist (tests/smoke, tests/helpers, tests/pages, scripts, docs)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-test-infrastructure/01-01-SUMMARY.md`
</output>
