---
phase: 09-account-verification
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - tests/game/slot-launch.spec.ts
  - tests/game/table-launch.spec.ts
  - tests/game/live-dealer-launch.spec.ts
  - tests/helpers/dismiss-details-modal.ts
autonomous: true
must_haves:
  truths:
    - "Game launch tests assert actual game iframe presence (not modal fallback)"
    - "All three game tests pass with iframe-only validation after verified account"
    - "The 'Set your details' modal workaround is removed from game assertions"
  artifacts:
    - path: "tests/game/slot-launch.spec.ts"
      provides: "Slot game iframe assertion"
      contains: "iframe"
    - path: "tests/game/table-launch.spec.ts"
      provides: "Table game iframe assertion"
      contains: "iframe"
    - path: "tests/game/live-dealer-launch.spec.ts"
      provides: "Live dealer game iframe assertion"
      contains: "iframe"
  key_links:
    - from: "tests/auth/auth.setup.ts"
      to: "tests/game/*.spec.ts"
      via: "storageState with verified account"
      pattern: "storageState.*\\.auth/user\\.json"
---

<objective>
Update game launch tests to assert actual game iframe presence instead of accepting the "Set your details" modal as a valid state.

Purpose: With verification complete (Plan 01), the "Set your details" modal no longer appears. Game tests should now assert the real success condition — a game iframe loading — catching actual game launch failures instead of masking them behind the modal fallback.

Output: Three updated game test specs asserting iframe-only. Deprecated dismiss-details-modal.ts helper removed.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@tests/game/slot-launch.spec.ts
@tests/game/table-launch.spec.ts
@tests/game/live-dealer-launch.spec.ts
@tests/helpers/dismiss-details-modal.ts
@tests/pages/GameDetailPage.ts
@.planning/phases/09-account-verification/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update game launch tests to assert iframe-only and remove modal workaround</name>
  <files>tests/game/slot-launch.spec.ts, tests/game/table-launch.spec.ts, tests/game/live-dealer-launch.spec.ts</files>
  <action>
In all three game launch spec files (`slot-launch.spec.ts`, `table-launch.spec.ts`, `live-dealer-launch.spec.ts`), replace the current `or` assertion pattern:

```typescript
// REMOVE this pattern:
const gameIframe = page.locator('iframe:not([title="Intercom"]):not([aria-hidden="true"])').first();
const playModeButton = page.getByRole('button', { name: /fun play|real play|set your details/i }).first();
await expect(gameIframe.or(playModeButton).first()).toBeVisible({ timeout: 30_000 });
```

Replace with iframe-only assertion:

```typescript
// REPLACE with:
const gameIframe = page.locator('iframe:not([title="Intercom"]):not([aria-hidden="true"])').first();
await expect(gameIframe).toBeVisible({ timeout: 30_000 });
```

This removes the `playModeButton` fallback entirely. After verification, the game iframe should always load for authenticated+verified accounts.

Keep the 30_000 timeout — game iframes are loaded by third-party providers and can be slow.

Remove the `playModeButton` variable declaration and the `.or()` chain in each file. The comment about "Set your details" modal is no longer applicable — update or remove it.
  </action>
  <verify>
  Run `npx tsc --noEmit` to verify TypeScript compiles. Grep all three game spec files to confirm no references to "fun play", "real play", "set your details", or `.or(playModeButton)` remain. Run `npx playwright test --list` to confirm test count is still 18.
  </verify>
  <done>
  All three game launch tests assert only the game iframe locator (no modal fallback). No references to "Set your details", "fun play", or "real play" in game spec files. TypeScript compiles. Test count unchanged at 18.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete the dismiss-details-modal helper (now unused)</name>
  <files>tests/helpers/dismiss-details-modal.ts</files>
  <action>
Delete `tests/helpers/dismiss-details-modal.ts` entirely. This helper was created to click "Fun Play" to bypass the "Set your details" modal. With verification now complete in auth setup, this modal no longer appears.

Before deleting, grep the codebase for any imports of `dismiss-details-modal` or `dismissDetailsModal` to confirm it's not used anywhere. If it IS imported somewhere, remove that import too.

Expected result: no file imports this helper (it was created as a utility but the game tests use inline selectors instead).
  </action>
  <verify>
  Confirm `tests/helpers/dismiss-details-modal.ts` no longer exists. Grep for `dismiss-details-modal` and `dismissDetailsModal` across the codebase — should return zero results. Run `npx tsc --noEmit` to verify no broken imports.
  </verify>
  <done>
  `tests/helpers/dismiss-details-modal.ts` deleted. No references to it remain in the codebase. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- All three game spec files assert `gameIframe` visibility without `.or()` fallback
- No references to "fun play", "real play", "set your details" in game spec files
- `tests/helpers/dismiss-details-modal.ts` does not exist
- `npx playwright test --list` shows 18 tests
- Run `npx playwright test tests/game/` (if possible against live site) — all 3 game tests pass with iframe-only assertion
</verification>

<success_criteria>
Game launch tests assert actual game iframe presence. The "Set your details" modal workaround is fully removed. All game tests validate real game loading for verified accounts.
</success_criteria>

<output>
After completion, create `.planning/phases/09-account-verification/09-02-SUMMARY.md`
</output>
