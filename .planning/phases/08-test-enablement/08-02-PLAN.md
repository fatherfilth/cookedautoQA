---
phase: 08-test-enablement
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/game/slot-launch.spec.ts
  - tests/game/table-launch.spec.ts
  - tests/game/live-dealer-launch.spec.ts
  - tests/crypto/swapped-buy-flow.spec.ts
  - tests/social/tipping-flow.spec.ts
autonomous: true
must_haves:
  truths:
    - "All 3 game launch tests assert iframe visibility and src without conditional test.skip — they expect auth to be present"
    - "Both crypto tests assert Swapped.com iframe loads without conditional test.skip on iframe visibility"
    - "Tipping test asserts tip button is visible without conditional test.skip on button visibility"
  artifacts:
    - path: "tests/game/slot-launch.spec.ts"
      provides: "Authenticated slot game launch test"
      contains: "gameIframe"
    - path: "tests/game/table-launch.spec.ts"
      provides: "Authenticated table game launch test"
      contains: "gameIframe"
    - path: "tests/game/live-dealer-launch.spec.ts"
      provides: "Authenticated live dealer game launch test"
      contains: "gameIframe"
    - path: "tests/crypto/swapped-buy-flow.spec.ts"
      provides: "Authenticated crypto buy flow tests"
      contains: "swappedIframe"
    - path: "tests/social/tipping-flow.spec.ts"
      provides: "Authenticated tipping flow test"
      contains: "tipButton"
  key_links:
    - from: "tests/game/slot-launch.spec.ts"
      to: ".auth/user.json"
      via: "Playwright storageState loaded by chromium project config"
      pattern: "gameIframe.*toBeVisible"
    - from: "tests/crypto/swapped-buy-flow.spec.ts"
      to: ".auth/user.json"
      via: "Playwright storageState loaded by chromium project config"
      pattern: "swappedIframe.*toBeVisible"
    - from: "tests/social/tipping-flow.spec.ts"
      to: ".auth/user.json"
      via: "Playwright storageState loaded by chromium project config"
      pattern: "tipButton.*click"
---

<objective>
Remove conditional skip directives from game launch, crypto, and tipping tests so they assert authenticated behavior rather than gracefully degrading to skip.

Purpose: These 6 tests (3 game, 2 crypto, 1 tipping) currently check if auth-dependent UI elements are visible, and if not, call `test.skip()`. With Phase 7's storageState providing authenticated sessions, these elements SHOULD always be visible. The conditional skips mask real failures — if the iframe doesn't appear under an authenticated session, that's a genuine breakage we want to catch, not silently skip.

Output: Six test specs that assert auth-dependent elements are visible (without skip fallbacks), ready to catch real regressions.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-auth-foundation/07-01-SUMMARY.md
@tests/game/slot-launch.spec.ts
@tests/game/table-launch.spec.ts
@tests/game/live-dealer-launch.spec.ts
@tests/crypto/swapped-buy-flow.spec.ts
@tests/social/tipping-flow.spec.ts
@tests/pages/GameDetailPage.ts
@tests/pages/SwappedIntegrationPage.ts
@tests/pages/ChatPage.ts
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove conditional skips from game launch tests</name>
  <files>tests/game/slot-launch.spec.ts, tests/game/table-launch.spec.ts, tests/game/live-dealer-launch.spec.ts</files>
  <action>
Update all 3 game launch specs (slot, table, live-dealer) to assert iframe behavior rather than conditionally skipping.

**For each of the 3 files, apply these changes:**

1. **Remove the iframe visibility skip block.** Replace:
   ```typescript
   const iframeVisible = await gameIframe.isVisible().catch(() => false);
   if (!iframeVisible) {
     test.skip(true, '...');
     return;
   }
   ```
   With a direct assertion:
   ```typescript
   await expect(gameIframe).toBeVisible({ timeout: 30_000 });
   ```
   Use 30s timeout because game iframes load game provider content which can be slow. This replaces both the `Promise.race` wait block AND the visibility check.

2. **Remove the iframe src skip block.** Replace:
   ```typescript
   const iframeSrc = await gameIframe.getAttribute('src');
   if (!iframeSrc) {
     test.skip(true, '...');
     return;
   }
   expect(iframeSrc).toBeTruthy();
   ```
   With:
   ```typescript
   const iframeSrc = await gameIframe.getAttribute('src');
   expect(iframeSrc).toBeTruthy();
   ```
   No skip fallback — if the iframe has no src under an authenticated session, that's a real failure.

3. **Remove the `Promise.race` block** (lines 18-21 in slot/table) that races iframe visibility against a raw timeout. Replace with the direct `toBeVisible` assertion from step 1.

4. **Keep everything else intact:** Game URL navigation, URL verification, iframe content assertion (canvas/game-container/body inside frameLocator), `@critical @game` tags.

**For live-dealer-launch.spec.ts specifically:** Keep the dynamic slug discovery logic (lines 9-25) that finds a live game from `/games/live-casino`. Only remove the skip blocks after navigation.

**Net effect per file:** Remove ~10 lines (Promise.race + two skip blocks), replace with 1 direct `toBeVisible` assertion and simplified src check.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm all 3 files compile. Run `npx playwright test --list` to confirm all 3 tests listed. Grep for `test.skip` in all 3 files — should return 0 matches.</verify>
  <done>All 3 game launch tests assert iframe visibility directly (no conditional skip), compile cleanly, and are listed in test suite.</done>
</task>

<task type="auto">
  <name>Task 2: Remove conditional skips from crypto and tipping tests</name>
  <files>tests/crypto/swapped-buy-flow.spec.ts, tests/social/tipping-flow.spec.ts</files>
  <action>
Update crypto buy flow and tipping flow tests to assert auth-dependent elements rather than conditionally skipping.

**For `tests/crypto/swapped-buy-flow.spec.ts`:**

1. **CRYPTO-01 test (iframe loads):**
   - Remove the try/catch skip around `cryptoPage.open()` (lines 36-44). Replace with direct call: `await cryptoPage.open();` — if the page fails to load under authenticated session, that's a real failure.
   - Remove the iframe visibility skip block (lines 48-52):
     ```typescript
     const iframeVisible = await cryptoPage.swappedIframe.isVisible().catch(() => false);
     if (!iframeVisible) { test.skip(...); return; }
     ```
     The `waitForReady()` in `cryptoPage.open()` already waits for iframe visibility (15s timeout). If it doesn't appear, `open()` will throw — which is the correct failure behavior.
   - Keep the src assertion and iframe content check intact.

2. **CRYPTO-02 test (buy flow progression):**
   - Same changes: remove try/catch skip around `cryptoPage.open()` (lines 91-98) and the iframe visibility skip block (lines 101-105).
   - Keep the amount entry, payment method selection, and buy button verification steps.
   - Keep the stop-before-purchase pattern (DO NOT click buy button).

**For `tests/social/tipping-flow.spec.ts`:**

1. **Remove the tip button visibility skip** (lines 23-27):
   ```typescript
   const tipVisible = await chatPage.tipButton.isVisible().catch(() => false);
   if (!tipVisible) { test.skip(...); return; }
   ```
   Replace with a direct click: `await chatPage.clickTipButton();` — the `clickTipButton()` method clicks the tip button directly. If the button isn't visible under authenticated session, Playwright will throw a proper timeout error.

2. Keep mobile viewport setting (`390x844`), chat drawer opening, tip modal interaction, confirmation dialog, and stop-before-payment pattern intact.

**Net effect:** Remove graceful degradation skips. Under authenticated sessions, missing elements indicate real breakages.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm both files compile. Run `npx playwright test --list` to confirm all 3 tests (2 crypto, 1 tipping) listed. Grep for `test.skip` in both files — should return 0 matches.</verify>
  <done>Both crypto tests and tipping test assert auth-dependent elements directly (no conditional skip), compile cleanly, and are listed in test suite.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — all 5 files compile cleanly
2. `npx playwright test --list` — all 6 tests listed (3 game + 2 crypto + 1 tipping)
3. No file in `tests/game/`, `tests/crypto/`, or `tests/social/tipping-flow.spec.ts` contains `test.skip(`
4. Game tests assert `gameIframe` with `toBeVisible` (not conditional skip)
5. Crypto tests call `cryptoPage.open()` without try/catch skip wrapper
6. Tipping test clicks tip button directly without visibility check skip
</verification>

<success_criteria>
- All 3 game launch tests assert iframe visible and has src (no skip fallback)
- Both crypto tests assert Swapped.com iframe loads (no skip fallback)
- Tipping test asserts tip button is clickable (no skip fallback)
- All 5 files compile with TypeScript
- All 6 tests appear in `playwright test --list` under chromium project
</success_criteria>

<output>
After completion, create `.planning/phases/08-test-enablement/08-02-SUMMARY.md`
</output>
