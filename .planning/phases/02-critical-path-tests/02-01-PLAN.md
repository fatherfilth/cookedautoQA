---
phase: 02-critical-path-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/smoke/homepage.spec.ts
  - tests/smoke/navigation.spec.ts
  - tests/smoke/lobby.spec.ts
  - tests/smoke/search.spec.ts
autonomous: true

must_haves:
  truths:
    - "Homepage loads and hero/main content element is visible"
    - "User can navigate to at least 2 major sections via top navigation and page content loads"
    - "Lobby page displays game categories and game grid is visible"
    - "Search returns results for a query and user can open a result to reach a game detail page"
  artifacts:
    - path: "tests/smoke/homepage.spec.ts"
      provides: "Homepage hero element smoke test"
      contains: "@critical @smoke"
    - path: "tests/smoke/navigation.spec.ts"
      provides: "Top navigation smoke test visiting 2+ destinations"
      contains: "@smoke"
    - path: "tests/smoke/lobby.spec.ts"
      provides: "Lobby page categories and game grid smoke test"
      contains: "@smoke"
    - path: "tests/smoke/search.spec.ts"
      provides: "Search flow smoke test with result validation"
      contains: "@smoke"
  key_links:
    - from: "tests/smoke/lobby.spec.ts"
      to: "tests/pages/LobbyPage.ts"
      via: "import LobbyPage"
      pattern: "import.*LobbyPage"
    - from: "tests/smoke/search.spec.ts"
      to: "tests/pages/LobbyPage.ts"
      via: "import LobbyPage for search interaction"
      pattern: "import.*LobbyPage"
---

<objective>
Create smoke tests (SMOKE-01 through SMOKE-04) validating that the homepage loads, top navigation works, lobby displays game categories, and search returns results.

Purpose: Smoke tests are the first line of defense -- they validate core page loads and navigation before deeper flows. If these fail, game and auth tests are likely broken too.
Output: 4 test spec files in tests/smoke/ covering homepage, navigation, lobby, and search flows.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@tests/pages/BasePage.ts
@tests/pages/LobbyPage.ts
@tests/helpers/test-config.ts
@tests/helpers/waits.ts
@tests/smoke/health-check.spec.ts
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create homepage and navigation smoke tests (SMOKE-01, SMOKE-02)</name>
  <files>tests/smoke/homepage.spec.ts, tests/smoke/navigation.spec.ts</files>
  <action>
Create `tests/smoke/homepage.spec.ts` for SMOKE-01:
- Import `test, expect` from `@playwright/test`
- Single test: `'homepage loads and hero element is visible @critical @smoke'`
- Navigate to `/` using `page.goto('/')`
- Assert page has a non-empty title: `await expect(page).toHaveTitle(/.+/)`
- Locate hero element using `.or()` chain: `page.locator('[data-testid="hero"]').or(page.locator('main').first())` — we use `main` as the fallback since we haven't inspected the live site yet
- Assert hero is visible: `await expect(hero).toBeVisible()`
- Assert hero has content (not empty): `await expect(hero).not.toBeEmpty()`

Create `tests/smoke/navigation.spec.ts` for SMOKE-02:
- Import `test, expect` from `@playwright/test`
- Single test: `'top navigation reaches at least 2 major sections @smoke'`
- Navigate to `/` using `page.goto('/')`
- Locate the navigation element: `page.getByRole('navigation').first().or(page.locator('nav').first())`
- Assert navigation is visible
- Navigate to first destination: Click a link matching `/lobby|games|casino|slots/i` in the nav. After click, wait for URL change with `page.waitForURL('**/*')`. Assert the new page has a visible heading (`page.getByRole('heading').first()` is visible) — this validates content loaded, not just URL changed.
- Navigate back to homepage: `page.goto('/')`
- Navigate to second destination: Click a link matching `/promotions|rewards|vip|about/i` in the nav. After click, wait for URL. Assert a heading is visible on the new page.
- Both navigations must assert content loaded (heading visible), not just URL changed (per research pitfall 7).

Follow the ESM import pattern from health-check.spec.ts. Use `@playwright/test` imports directly. Do NOT import page objects for these tests — they test raw navigation, not page object methods.
  </action>
  <verify>
Run `npx playwright test tests/smoke/homepage.spec.ts --list` and `npx playwright test tests/smoke/navigation.spec.ts --list` — both tests should be listed.
Run `npm run typecheck` — no TypeScript errors.
Run `npx playwright test tests/smoke/homepage.spec.ts tests/smoke/navigation.spec.ts --grep @smoke --list` — both should appear in filtered list.
  </verify>
  <done>
homepage.spec.ts: Test listed, asserts hero/main element visible and has content, tagged @critical @smoke.
navigation.spec.ts: Test listed, navigates to 2+ sections, asserts content loaded (heading visible) after each navigation, tagged @smoke.
TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create lobby and search smoke tests (SMOKE-03, SMOKE-04)</name>
  <files>tests/smoke/lobby.spec.ts, tests/smoke/search.spec.ts</files>
  <action>
Create `tests/smoke/lobby.spec.ts` for SMOKE-03:
- Import `test, expect` from `@playwright/test`
- Import `LobbyPage` from `../pages/LobbyPage.js` (ESM .js extension)
- Single test: `'lobby page displays game categories and game grid @smoke'`
- Create `new LobbyPage(page)` and call `await lobbyPage.open()`
- Assert `lobbyPage.gameCategories` is visible (categories exist on page)
- Assert `lobbyPage.gameGrid` is visible (game grid rendered)
- Assert game grid has at least 1 child element: `await expect(lobbyPage.gameGrid.locator('> *').first()).toBeVisible()`
- This validates categories and grid are present, not just that the page loaded.

Create `tests/smoke/search.spec.ts` for SMOKE-04:
- Import `test, expect` from `@playwright/test`
- Import `LobbyPage` from `../pages/LobbyPage.js`
- Single test: `'search returns results and user can open a game @smoke'`
- Create `new LobbyPage(page)` and call `await lobbyPage.open()`
- Search for a broad term: `await lobbyPage.searchForGame('slots')` — use a broad term likely to return results
- Wait for search results: After filling search, either press Enter (`await lobbyPage.searchInput.press('Enter')`) or wait for results to update automatically. Wait for game grid to be visible.
- Assert at least 1 result exists: `const resultCount = await lobbyPage.gameGrid.locator('> *').count(); expect(resultCount).toBeGreaterThan(0);`
- Click the first result: `await lobbyPage.clickFirstGame()`
- Assert navigation to game detail page: `await page.waitForURL('**/games/**')` and assert a heading is visible on the detail page: `await expect(page.getByRole('heading').first()).toBeVisible()`
- This validates search results appear AND that opening a result works (per research pitfall 6 — validate results, not just search action).

Both files must use .js extension for ESM imports. Follow the pattern established in health-check.spec.ts.
  </action>
  <verify>
Run `npx playwright test tests/smoke/lobby.spec.ts --list` and `npx playwright test tests/smoke/search.spec.ts --list` — both tests should be listed.
Run `npm run typecheck` — no TypeScript errors.
Run `npx playwright test tests/smoke/ --list` — all smoke tests listed (health-check, homepage, navigation, lobby, search).
  </verify>
  <done>
lobby.spec.ts: Test listed, imports LobbyPage, asserts game categories and game grid visible with at least 1 game tile, tagged @smoke.
search.spec.ts: Test listed, imports LobbyPage, searches for a term, asserts results > 0, clicks first result and verifies navigation to game detail page, tagged @smoke.
TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
- All 4 smoke test files exist in tests/smoke/
- Each test is tagged with @smoke (homepage also tagged @critical)
- TypeScript compiles: `npm run typecheck` passes
- All tests appear in `npx playwright test tests/smoke/ --list`
- No networkidle or waitForTimeout usage in any smoke test file
- lobby.spec.ts and search.spec.ts import LobbyPage from page objects
- Navigation test validates content (heading visible), not just URL changes
- Search test validates results count > 0 and opens a result
</verification>

<success_criteria>
- 4 smoke test spec files exist and are listed by Playwright
- Tests cover SMOKE-01 (homepage hero), SMOKE-02 (navigation to 2+ sections), SMOKE-03 (lobby categories + grid), SMOKE-04 (search + open result)
- All tests tagged @smoke for filtering
- TypeScript compiles without errors
- No forbidden patterns (networkidle, waitForTimeout, CSS class selectors)
</success_criteria>

<output>
After completion, create `.planning/phases/02-critical-path-tests/02-01-SUMMARY.md`
</output>
